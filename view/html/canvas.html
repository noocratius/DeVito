<div class="add-widget">
  <div class="container">
    <textarea class="post-it">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</textarea>
    <button type="button">salvar</button>
  </div>
</div>
<article class="business-model-canvas">
  <div class="upper-column">
    <div class="canvas-column canvas-element">
      <h1>Parcerias Chaves <i class="fas fa-link"></i></h1>
      <div class="canvas-body-element">
      </div>
      <div class="canvas-element-add-button">
        <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
      </div>
    </div>
    <div class="canvas-column">
      <div class="canvas-element">
        <h1>Atividades Chave <i class="fas fa-check"></i></h1>
        <div class="canvas-body-element">
          <div class="post-it">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
          </div>
          <div class="post-it">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
          </div>
        </div>
        <div class="canvas-element-add-button">
          <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
        </div>
      </div>
      <div class="canvas-element">
        <h1>Recursos Chave <i class="fas fa-puzzle-piece"></i></h1>
        <div class="canvas-body-element">
          <div class="post-it">
            post-it #00
          </div>
          <div class="post-it">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
          </div>
        </div>
        <div class="canvas-element-add-button">
          <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
        </div>
      </div>
    </div>
    <div class="canvas-column canvas-element">
      <h1>Proposta de Valor <i class="fas fa-gift"></i></h1>
      <div class="canvas-body-element">
      </div>
      <div class="canvas-element-add-button">
        <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
      </div>
    </div>
    <div class="canvas-column">
      <div class="canvas-element">
        <h1>Relação com o Cliente <i class="fas fa-heart" aria-hidden="true"></i></h1>
        <div class="canvas-body-element">
        </div>
        <div class="canvas-element-add-button">
          <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
        </div>
      </div>
      <div class="canvas-element">
        <h1>Canais <i class="fas fa-truck"></i></h1>
        <div class="canvas-body-element">
        </div>
        <div class="canvas-element-add-button">
          <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
        </div>
      </div>
    </div>
    <div class="canvas-column canvas-element">
      <h1>Segmentos de Mercado <i class="fas fa-users"></i></h1>
      <div class="canvas-body-element">
      </div>
      <div class="canvas-element-add-button">
        <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
      </div>
    </div>
  </div>
  <div class="bottom-column">
    <div class="canvas-column canvas-element">
      <h1>Estrutura de Custos <i class="fas fa-tags"></i></h1>
      <div class="canvas-body-element">
      </div>
      <div class="canvas-element-add-button">
        <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
      </div>
    </div>
    <div class="canvas-column canvas-element">
      <h1>Fontes de Renda <i class="fas fa-money-bill-alt"></i></h1>
      <div class="canvas-body-element">
        <div class="post-it">
          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div>
        <div class="post-it">
          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div>
        <div class="post-it">
          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div>
      </div>
      <div class="canvas-element-add-button">
        <button type="button"><i class="fas fa-plus"></i> Adicionar post-it</button>
      </div>
    </div>
  </div>
</article>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

  /**
   * Retorna a propriedade css sem unidade
   *
   * @param {string} property - Propriedade em unidades usadas pelo stylesheet
   */
  var unitlessAttr = function(property) {
    return property.match(/\d+/)[0];
  }

  console.log('loaded0');
  $.when( $.ready ).then(function () {

    console.log('loaded1');

    // objeto que lida com business model canvas
    var $canvas, $upper, $bottom, lineHeight, upperHeight, bottomHeight, headerHeight, buttonHeight;

    $canvas = $('.business-model-canvas');

    lineHeight = unitlessAttr($canvas.css('lineHeight'));
    $upper = $('.upper-column');
    $bottom = $('.bottom-column');

    upperHeight = unitlessAttr($upper.css('height'));
    bottomHeight = unitlessAttr($bottom.css('height'));
    headerHeight = Number(unitlessAttr($('.canvas-element h1', $upper).css('height')));
    buttonHeight = Number(unitlessAttr($('.canvas-element button', $upper).css('height')));
    var extraHeight = headerHeight + buttonHeight;

    $('.canvas-element > .canvas-body-element', $upper).css('height', upperHeight/2 - extraHeight);
    $('.canvas-column > .canvas-body-element', $upper).css('height', upperHeight - extraHeight);
    $('.canvas-body-element', $bottom).css('height', bottomHeight - extraHeight);

    $(window).resize(function () {

      upperHeight = unitlessAttr($upper.css('height'));
      bottomHeight = unitlessAttr($bottom.css('height'));

      $('.canvas-element .canvas-body-element', $upper).css('height', upperHeight/2 - extraHeight);
      $('.canvas-column.canvas-element .canvas-body-element', $upper).css('height', upperHeight - extraHeight);
      $('.bottom-column .canvas-body-element').css('height', bottomHeight - extraHeight);

    });

    // adiciona comportamento para fechar/abrir janela de adição de post-it's
    $('.canvas-element-add-button').click(function (){ $('.add-widget').fadeIn(200); })
    $('.add-widget .post-it').click(function(e){ e.stopPropagation(); })
    $('.add-widget').click(function(e){ $(this).fadeOut(200); })
  });


  // recalcula o tamanho da linha quando der resize
</script>
